# Supabase Integration

This project stores contact form submissions in Supabase.

## Database Schema

Create a `contact_messages` table:

```sql
create table if not exists contact_messages (
  id bigint generated by default as identity primary key,
  name text,
  email text,
  message text,
  created_at timestamp with time zone default timezone('utc'::text, now())
);
```

Enable Row Level Security and allow inserts using the service role key:

```sql
alter table contact_messages enable row level security;
create policy "Allow inserts with service role" on contact_messages
  for insert using (auth.role() = 'service_role');
```

## Environment Variables

These variables must be available at build and runtime:

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- `SUPABASE_SERVICE_ROLE_KEY`

Set them in DigitalOcean App Platform via `.do/app.yaml` and configure matching GitHub secrets so deployment workflows can pass them through.

## Verification

After deploying with the variables configured, test the endpoint:

```bash
curl -X POST "$SITE_URL/api/contact" \\
  -H 'Content-Type: application/json' \\
  -d '{"name":"Test","email":"user@example.com","message":"Hello"}'
```

A `200` response indicates the request was accepted. Check the `contact_messages` table in Supabase to confirm the row was created.
